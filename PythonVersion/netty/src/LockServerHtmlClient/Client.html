<!DOCTYPE html>
<html>
<head>

        <meta charset="utf-8" />
        <title>Lock Test: Client A</title>
        <link href="bootstrap.css" rel="stylesheet">
    <style>
        body {
            padding:20px;
        }
        #console {
            height: 400px;
            overflow: auto;
        }
        .username-msg {color:orange;}
        .connect-msg {color:green;}
        .disconnect-msg {color:red;}
        .send-msg {color:#888}
    </style>


    <script src="js/socket.io/socket.io.js"></script>
    <script src="js/moment.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>

    <script>

        var userName = 'user' + Math.floor((Math.random()*1000)+1);
        var socket =  io.connect('http://10.239.44.74:9092');
        var socket_control =  io.connect('http://10.239.44.74:9091');
        var lock = 'nothing';
        socket.on('connect', function() {
            output('<span class="connect-msg">Client has connected to the server! actionlock</span>');
        });
        socket_control.on('connect', function() {
            output('<span class="connect-msg">Client has connected to the server! controllock</span>');
        });
        socket.on('waitactionlock', function(data) {
            output('<span class="username-msg">' +'actionlock' + ':</span> ' + data.lock);
            lock=data.lock;
        });

        socket_control.on('waitcontrollock', function(data) {
            output('<span class="username-msg">' +'controllock' + ':</span> ' + data.lock);
            lock=data.lock;
        });
        socket.on('disconnect', function() {
            output('<span class="disconnect-msg">The client has disconnected! actionlock</span>');
        });
        socket_control.on('disconnect', function() {
            output('<span class="disconnect-msg">The client has disconnected! controllock</span>');
        });
        function startTest() {
            sendLock('STARTTEST');
            output('<span class="connect-msg">Start Test!</span>');
        }

        function resetLock() {
            sendLock('InitActionLock');
            output('<span class="connect-msg">actionLock Reseted!</span>');
        }
        function resetLock_control() {
            sendLock_control('InitControlLock');
            output('<span class="connect-msg">controlLock Reseted!</span>');
        }
        /*function waitLock(targetLock){
            if(lock==targetLock){
            output('<span class="connect-msg">lock:'+lock+'</span>');
                return ;
            }else{
                //continue wait 1s
                setTimeout(waitLock(targetLock), 1000);
            }
        }*/

        function sendMessage() {
                        var message = $('#msg').val();
                        $('#msg').val('');
                        sendLock(message);
        }
        function sendMessage_control() {
                        var message = $('#msg').val();
                        $('#msg').val('');
                        sendLock_control(message);
        }
        function sendLock(lockmsg) {
                        var jsonObject = {lock: lockmsg};
                        socket.emit('lockevent', jsonObject);
        }

       function sendLock_control(lockmsg) {
                        var jsonObject = {lock: lockmsg};
                        socket_control.emit('controlevent', jsonObject);
        }

        function output(message) {
                        var currentTime = "<span class='time'>" +  moment().format('HH:mm:ss.SSS') + "</span>";
                        var element = $("<div>" + currentTime + " " + message + "</div>");
            $('#console').prepend(element);
        }

    </script>
</head>

<body>

    <h1>Netty-socketio Demo Chat</h1>

    <br/>

    <div id="console" class="well">
    </div>

        <form class="well form-inline" onsubmit="return false;">
           <input id="msg" class="input-xlarge" type="text" placeholder="Type Lock..."/>
           <button type="button" onClick="sendMessage()" class="btn">Send_ation</button>
           <button type="button" onClick="sendMessage_control()" class="btn">Send_control</button>
           <button type="button" onClick="startTest()" class="btn">StartTest</button>
           <button type="button" onClick="resetLock()" class="btn">ResetLock</button>
           <button type="button" onClick="resetLock_control()" class="btn">ResetControlLock</button>
        </form>



</body>

</html>
